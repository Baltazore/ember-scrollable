machine:
  environment:
    PATH: "${HOME}/${CIRCLE_PROJECT_REPONAME}/bin:${HOME}/${CIRCLE_PROJECT_REPONAME}/node_modules/.bin:${PATH}"
  node:
    version: 0.12.0

test:
  override:
    - ./bin/ci

dependencies:
  override:
    - "cd bin && wget https://s3.amazonaws.com/travis-phantomjs/phantomjs-2.0.0-ubuntu-12.04.tar.bz2 && tar xjvf phantomjs-2.0.0-ubuntu-12.04.tar.bz2"
    - "./bin/setup"

deployment:
  production:
    branch: master
    commands:
      - "ember divshot push production --token $DIVSHOT_TOKEN --org AlphaSights"
      - "ASSET_HOST='https://dqnspx0v9vwle.cloudfront.net/' ember deploy --environment production"
      - 'ember deploy:activate --revision `ember deploy:list --environment production | grep phoenix: | sed -e "s/.*phoenix/phoenix/g" | head -n 1` --environment production'

  staging:
    branch: develop
    commands:
      - "ember divshot push staging --token $DIVSHOT_TOKEN --org AlphaSights"
